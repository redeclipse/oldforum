    efuiinsel = 0

    efuitype = 0
    efuiattr0 = 0
    efuiattr1 = 0
    efuiattr2 = 0
    efuiattr3 = 0
    efuiattr4 = 0

    efuidotype = 1
    efuidoattr0 = 1
    efuidoattr1 = 1
    efuidoattr2 = 1
    efuidoattr3 = 1
    efuidoattr4 = 1

    entupdate = [ entset $tmpt $tmp0 $tmp1 $tmp2 $tmp3 ]

    initentgui = [
        tmpt = (enttype)
        @(loopconcat i 4 [result [
            tmp@i = (entattr @i)
        ]])
    ]

    genentattributes = [
        entattributes = ""
        n = (listlen $arg2)
        loop i $n [
            entattributes = (concat $entattributes [
                guitext @(at $arg2 $i)
                guislider tmp@i @(at $arg3 (* 2 $i)) @(at $arg3 (+ 1 (* 2 $i))) entupdate
            ])
        ]
    ]

    newgui entfind [
        guitext "set the attributes below to search for"
        guistrut 1
        guilist [
            guicheckbox "type   " efuidotype
            guistrut 1
            efuitypename = (at $enttypelist $efuitype)
            guifield efuitypename 11 [efuitypeval = (indexof $enttypelist $efuitypename)
            if (>= $efuitypeval 0) [efuitype = $efuitypeval]]
        ]
        loop i 5 [
            guilist [
                guicheckbox [attr @(+ $i 1)] [efuidoattr@i]
                guistrut 1
                guifield [efuiattr@i] 11 [ efuiattr@i = (+ $efuiattr@i 0)]
            ]
        ]

        guilist [
            guiradio "off" efuiinsel 0
            guistrut 1
            guiradio "inside selection" efuiinsel 1
            guistrut 1
            guiradio "outside selection" efuiinsel 2
        ]

        guibar
        guistayopen [
            guibutton "copy attributes from currently selected entity" [
                loop i 5 [
                    [efuiattr@i] = (+ (entattr $i) 0)
                    echo [efuiattr@i] = (+ (entattr $i) 0)
                ]
                efuitypeval = (indexof $enttypelist (enttype))
                if (>= $efuitypeval 0) [efuitype = $efuitypeval]
            ]
            guibutton "select all valid entities" [entselect [efuimatch]]
        ]

        guitab type
        guilist [
            loop i (+ (div (listlen $enttypelist) 10) 1) [
                guilist [
                    loop j (min (- (listlen $enttypelist) (* 10 $i)) 10) [
                        guiradio (at $enttypelist (+ $j (* $i 10))) efuitype (+ $j (* $i 10))
                    ]
                ]
            ]
        ]
    ]

    newmapsize = 12
    savemap_name = temp

    newgui edit [
        guilist [
            guilist [
                guibutton   "toggle walk / edit mode"            "edittoggle"
                guitext
                guibutton   "open textures menu.."               "showtexgui"
                guibutton   "open this edit menu.."               " "
                guibutton   "open materials menu.."               "showgui materials"
                guibutton   "open console.."                  "saycommand /"
                guitext
                guibutton    "optimize geometry"                  "remip"
                guibutton   "patch existing lightmap (patch)"      [fullbright 0; patchlight]
                guibutton   "quick calculate lights (preview)"      [fullbright 0; calclight -1]
                guibutton    "full calculate lights (full)"         [fullbright 0; calclight 1]
                guitext
                guibutton   "environment settings.."            "showgui environment"
                guitext
                guibutton   "claim privileges.."               "showgui serverpriv"
                guitext
                guibutton    "send map to server"               "sendmap"
                guibutton   "get map from server"               "getmap"
                guitext
                guibutton   "take screenshot"                  [ cleargui; sleep 0 [ screenshot ] ]
            ]
            guilist [
                guitext (format "key %1") (searcheditbinds "edittoggle")
                guitext
                guitext (format "key %1") (searcheditbinds "showtexgui")
                guitext (format "key %1") (searcheditbinds "showgui edit")
                guitext (format "key %1") (searcheditbinds "showgui materials")
                guitext (format "key %1") (searcheditbinds "saycommand /")
                guitext
                guitext (format "key %1") (searcheditbinds "remip")
                guitext (format "key %1") (searcheditbinds [fullbright 0; patchlight])
                guitext (format "key %1") (searcheditbinds [fullbright 0; calclight -1])
                guitext (format "key %1") (searcheditbinds [fullbright 0; calclight 1])
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "sendmap")
                guitext (format "key %1") (searcheditbinds "getmap")
                guitext
                guitext (format "key %1") (searcheditbinds "screenshot")
            ]
        ]



        guitab file
        guilist [
            guilist [
                guitext
                guitext    "set map title.."
                guifield                                     maptitle 40 [ maptitle $maptitle ]
                guitext    "set map author.."
                guifield                                      mapauthor 40 [ mapauthor $mapauthor ]
                guitext    "set map filename"
                guifield                                      savemap_name 40 [ savemap $savemap_name ]
                guitext
                guibutton   "^foSAVE ^fwmap as filename"            "savemap"
                guitext
                guibutton    "increase mapsize (2x)"                    "mapenlarge"
                guitext
                guibutton   "start new map"                        "showgui newmapgui"
            ]
            guilist [
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "savemap")
                guitext
                guitext
                guitext
                guitext
            ]
        ]

        guitab ents
        guilist [
            guilist [
                guibutton   "find ents"            "showgui entfind"
                guitext
                guibutton   "link selected ents (teleport, sound, trigger)"   "showgui entlink"
                guitext
                guibutton   "focus on selected ent"                           "entautoview"
                guibutton   "deselect all ents"                              "entcancel"
                guibutton   "edit selected ent"                              "selentedit"
                guitext
                guibutton   "select all ents inside selection area"               "entselect insel"
                guibutton   "select all ents matching selected"                  "selentfindall"
                guitext
                guitext
                guibutton   "create weapon.."                              "showgui createweapon"
                guibutton   "create playerstart"                           "saycommand [/newent playerstart 0 0 0 0 0]"
                guibutton   "create light.."                              "resetlight;showgui newlight"
                guibutton   "create lightfx.."                              "saycommand [/newent lightfx 0 0 0 0 0]"
                guibutton   "create teleport.."                              "showgui newteleport"
                guibutton   "create mapmodel"                              "saycommand [/newent mapmodel 0 0 0 0 0]"
                guibutton   "create sound"                                 "saycommand [/newent sound 0 0 0 0 0]"
                guibutton   "create pusher"                                 "saycommand [/newent pusher 0 90 200 0 0 0]"
                guibutton   "create affinity (flag, bomb)"                     "saycommand [/newent affinity 0 0 0 0 0]"
                guibutton   "create actor"                                 "saycommand [/newent actor 0 0 0 0 0 0 0 0 0]"
                guibutton   "create trigger"                              "saycommand [/newent trigger 0 0 0 0 0 0 ]"
                guibutton   "create checkpoint"                              "saycommand [/newent checkpoint 0 0 0 0 0 0 ]"
            ]
            guilist [
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "entlink")
                guitext
                guitext (format "key %1 + scroll") (searcheditbinds [ domodifier 10; onrelease entautoview ])
                guitext (format "key %1") (searcheditbinds "entcancel")
                guitext (format "key %1") (searcheditbinds "selentedit")
                guitext
                guitext (format "key %1") (searcheditbinds "entselect insel")
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
            ]
        ]

        guitab ops
        guilist [
            guilist [
                guibutton   "copy"                                    "copy"
                guibutton   "paste"                                    "paste"
                guitext
                guibutton   "mirror geometry per selection orientation"         "flip"
                guibutton   "delete selected ents / geometry"               "
                guibutton   "grab texture from selected face"               "gettex"
                guibutton   "repeat last texture change across entire map"      [allfaces 0; replace]
                guitext
                guibutton   "toggle heightmap mode"                        "hmapedit 1"
                guitext
                guibutton   "materials.."                              [showgui materials]
                guitext
                guibutton   "waypoints.."                              [showgui waypoints]
                guitext
                guibutton   "undo"                                    "undo"
                guibutton   "redo"                                    "redo"
                guitext      "undo cache size (default: 5 MB)"
                guislider                                          "undomegs" 1 10"
			]
            
            guilist [
                guitext (format "key %1") (searcheditbinds "copy")
                guitext (format "key %1") (searcheditbinds "paste")
                guitext
                guitext (format "key %1") (searcheditbinds "flip")
                guitext (format "key %1") (searcheditbinds "editdel")
                guitext (format "key %1") (searcheditbinds "gettex")
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds [ hmapedit (! $hmapedit); blendpaintmode 0 ])
                guitext
                guitext (format "key %1") (searcheditbinds "showgui materials")
                guitext
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "undo")
                guitext (format "key %1") (searcheditbinds "redo")
                guitext
                guitext
            ]
        ]

        guitab vtex
        guilist [
            guilist [
                guitext "create new version of the selected face texture:"
                guitext ""
                guibutton "color.."                                       "showgui vcolour"
                guitext
                guibutton "scale.."                                       "showgui vscale"
                guibutton "rotate / flip.."                                 "showgui vrotate"
                guibutton "offset texture up or down.."                        "showgui voffset"
                guitext
                guibutton "texture scrolling.."                              "showgui vscroll"
                guitext
                guibutton "glow color.."                                 "showgui glowcolor"
                guibutton "specularity (gloss).."                           "showgui specscale"
                guibutton "heightmap intensity.."                           "showgui parallaxscale"
                guitext
                guibutton "texture blend painting.."                        "showgui blendmap"
                guitext
                guibutton "^foRESET ^fwselected textures to default"            "vreset"
                guitext
                guibutton "^foRESET ^fwall textures in map"                     "showgui texreset"
            ]
        ]

        guitab helpers
        guilist [
            guilist [
                guicheckbox   "toggle edit radar"                  [showeditradar]
                guicheckbox   "show material volumes"               "showmat"
                guitext
                guicheckbox   "toggle fullbright"                  "fullbright"
                guicheckbox   "toggle wireframe"                  "wireframe"
                guicheckbox   "toggle blank geometry"               "blankgeom"
                guicheckbox   "toggle outline"                  "outline"
                guibutton   "set outline color.."               "showgui outlinecolor"
                guitext
                guicheckbox   "toggle paste grid"                  "showpastegrid"
                guicheckbox   "toggle cursor grid"               "showcursorgrid"
                guicheckbox   "toggle selection grid"               "showselgrid"
                guicheckbox   "snap ents to grid"                  "entselsnap"
                guitext
                guicheckbox   "toggle allfaces texture mode"         "allfaces"
                guitext
                guitext    "adjust your float speed (0-1000)"
                guifield                                   floatspeed 10 [ floatspeed $floatspeed ]
            ]
            guilist [
                guitext   "               toggle edit radar"
                guitext (format "key %1") (searcheditbinds "showmat")
                guitext
                guitext (format "key %1") (searcheditbinds "fullbright")
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "outline")
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "togglegrid")
                guitext (format "key %1") (searcheditbinds "togglegrid")
                guitext (format "key %1") (searcheditbinds "togglegrid")
                guitext
                guitext
                guitext (format "key %1") (searcheditbinds "allfaces")
            ]
        ]


        guitab lightmap
        guilist [
            guilist [
                guitext "lightprecision (default: 32)"
                guitext "^fr(Notice!)^fw Increasing the lightprecision creates a smaller mapfile"
                guilistslider lightprecision "8 16 32 48 64 128 256"
                guitext "lighterror (default: 8)"
                guislider lighterror
                guitext "lightthreads (CPU threads/cores) (default: 0)"
                guislider lightthreads
                guitext
                guibutton "set min light level / shadow color (ambient)..."                   "showgui environment 2"
                guitext
                guibutton "optimize geometry"                                    "remip"
                guibutton "patch existing lightmap (patch)"                           [fullbright 0; patchlight]
                guibutton "quick calculate lights (preview)"                        [fullbright 0; calclight -1]
                guibutton "full calculate lights (full)"                           [fullbright 0; calclight 1]
            ]
            guilist [
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext "      key F4"
                guitext "      key F5"
                guitext "      key F6"
                guitext "      key F7"
            ]
        ]

        guitab keyref
        guilist [
            guilist [
                guitext "change gridsize"
                guitext "select"
                guitext "extend selection / select additional ents"
                guitext   "move selection area / move selected ents"
                guitext   "deselect all"
                guitext   "orient selection face"
                guitext   "create /destroy cubes"
                guitext   "push / pull selected faces"
                guitext   "push / pull corner"
                guitext "select multiple corners"
                guitext   "move selected geometry"
                guitext   "copy"
                guitext   "paste"
                guitext   "rotate geometry per selection orientation"
                guitext   "mirror geometry per selection orientation"
                guitext   "quick texture selected faces"
                guitext   "grab texture from selected faces"
                guitext "change properties of selected ents"
                guitext   "cycle link modes for selected ents"
                guitext   "change brush type"
            ]
            guilist [
                guitext "   hold key G + scroll wheel"
                guitext "   drag left mouse button"
                guitext "   right mouse button"
                guitext "   right mouse button"
                guitext "   key Space"
                guitext "   right mouse button"
                guitext "   scroll mouse wheel"
                guitext "   hold key F + scroll mouse wheel"
                guitext "   hold key Q + scroll wheel"
                guitext "   drag middle mouse button"
                guitext "   hold key U + drag right mouse button"
                guitext "   key C"
                guitext "   key V"
                guitext "   hold key R + scroll mouse wheel"
                guitext "   key X"
                guitext "   hold key Y + scroll mouse wheel"
                guitext "   key J"
                guitext "   hold number keys 1-9 + scroll mouse wheel"
                guitext   "   key L"
                guitext "   hold key K + scroll mouse wheel"
            ]
        ]

        guitab cfg
        guitext [@[mapname].cfg]
        showfileeditor [@[mapname].cfg] -80 20
    ]









    newgui serverpriv [
        guistayopen [
            guiradio   "veto server"               openservertype 0   [serveropen 3]
            guiradio   "open server"               openservertype 1   [serveropen 1]
            guiradio   "coop server"               openservertype 2   [serveropen 2]
            guitext
            guibutton   "claim privileges"            "setpriv 1"
            guibutton   "relinquish privileges"         "setpriv 0"
            guitext
            guibutton   "administrator password"      "saycommand [/adminpass ]"
        ]
    ]

    newgui waypoints [
            guicheckbox   "show waypoints"                     "showwaypoints"
            guicheckbox   "create waypoints"                     "dropwaypoints"
            guiradio   "gamespeed 100% (default)"               gamespeedtype 0   [gamespeed 100]
            guiradio   "gamespeed 200% (faster waypointing)"      gamespeedtype 1   [gamespeed 200]
            guiradio   "gamespeed 75% (slower waypointing)"      gamespeedtype 2   [gamespeed 75]
            guitext
            guibutton   "add bot"                           "addbot"
            guibutton   "remove bot"                        "delbot"
            guitext
            guibutton   "^foSAVE ^fwwaypoints"                  "savewaypoints"
            guibutton   "^foLOAD ^fwwaypoints"                  "saycommand [/loadwaypoints ]"
            guibutton   "^foSAVE ^fwmap"                     "savemap"
            guibutton   "^foCLEAR ^fwwaypoints in selection area"   "saycommand [/delselwaypoints]"
            guibutton   "^foCLEAR ^fwall waypoints"               "saycommand [/clearwaypoints]"
    ]
    newgui createweapon [
            guilist [
                guilist [
                guitext   "^fo/newent weapon ^fy#"
                guibutton "sword"         "newent weapon 2"
                guibutton "shotgun"         "newent weapon 3"
                guibutton "smg"            "newent weapon 4"
                guibutton "flamer"         "newent weapon 5"
                guibutton "plasma"         "newent weapon 6"
                guibutton "taser"         "newent weapon 7"
                guibutton "rifle"         "newent weapon 8"
                guibutton "grenade"         "newent weapon 9"
                guibutton "mine"         "newent weapon 10"
                guibutton "rocket"         "newent weapon 11"
                ]
                guilist [
                guitext
                guitext "weapon 2"
                guitext "weapon 3"
                guitext "weapon 4"
                guitext "weapon 5"
                guitext "weapon 6"
                guitext "weapon 7"
                guitext "weapon 8"
                guitext "weapon 9"
                guitext "weapon 10"
                ]
            ]
    ]

    newgui newmapgui [
            guibutton    "^foREVERT ^fwto last saved version of @savemap_name"      "map $savemap_name"
            guitext
            guibutton   "^foOPEN ^fwan existing map"                        "showgui maps 1"
            guitext
            guibutton    "^foCLEAR MAP ^fwand begin a new one ^fr(Warning!)"         "newmap $newmapsize"
            guitext      "size of new map"
            guislider    "newmapsize" 10 16
    ]

    newgui outlinecolor [
                guiradio   "white"               outlinetype 1 [outlinecolour 255 255 255]
                guiradio   "black"               outlinetype 2 [outlinecolour 0 0 0]
                guiradio   "blue"               outlinetype 3 [outlinecolour 80 80 255]
                guiradio   "red"               outlinetype 4 [outlinecolour 255 80 80]
                guiradio   "green"               outlinetype 5 [outlinecolour 80 255 80]
                guiradio   "yellow"            outlinetype 6 [outlinecolour 255 255 80]
                guitext
                guicheckbox   "toggle outline"      "outline"
    ]


    newgui entlink [
        guistayopen [
        guitext "^fo/entlink ^fw cycles link modes of selected ents"
        guitext
        guibutton    "cycle linkmode +         key L"               "entlink"
        guitext
        guitext    "link modes:"
        guitext      "1. A     B"
        guitext    "2. ^frA >> B"
        guitext      "3. ^fyA <> B"
        guitext    "4. ^frA << B"
        guitext
        guibutton   "create new teleport"                            "saycommand [/newent teleport -1 0 0 0 655 0]"
        guibutton   "create new sound"                              "saycommand [/newent sound 0 0 0 0 0]"
        guibutton   "create new trigger"                           "saycommand [/newent trigger 0 0 0 0 0 0 0]"
        ]


    ]


    newgui vcolour [
        guistayopen [
            guitext "^fo/vcolour ^fr%R ^fg%G ^fb%B"
            guitext
            guibutton "red"            "saycommand [/vcolour 1.0 0.3 0.3]"
            guibutton "green"         "saycommand [/vcolour 0.3 1.0 0.3]"
            guibutton "blue"         "saycommand [/vcolour 0.3 0.3 1.0]"
            guibutton "orange"         "saycommand [/vcolour 1.0 0.6 0.2]"
            guibutton "yellow"         "saycommand [/vcolour 1.0 0.8 0.3]"
            guibutton "purple"         "saycommand [/vcolour 0.5 0.2 0.7]"
            guibutton "turquoise"      "saycommand [/vcolour 0.1 0.8 0.8]"
            guibutton "dark"         "saycommand [/vcolour 0.3 0.3 0.3]"
            guibutton "white"         "saycommand [/vcolour 1.0 1.0 1.0]"
        ]
    ]

    newgui vscale [
        guistayopen [
        guitext "^fo/vscale ^fy% ^fw(0.125 - 8.0)"
        guitext
        guibutton "12.5%"      "saycommand [/vscale .125]"
        guibutton "25%"         "saycommand [/vscale .25]"
        guibutton "50%"         "saycommand [/vscale .5]"
        guibutton "75%"         "saycommand [/vscale .75]"
        guibutton "100%"      "saycommand [/vscale 1]"
        guibutton "150%"      "saycommand [/vscale 1.5]"
        guibutton "400%"      "saycommand [/vscale 4]"
        guibutton "800%"      "saycommand [/vscale 8]"
        ]
    ]

    newgui vrotate [
        guistayopen [
            guitext "^fo/vrotate ^fy# ^fy(1-3 rotate, 4-5 flip)"
            guitext
            guibutton "rotation/flip +"               "vdelta vrotate 1"
            guibutton "rotation/flip -"               "vdelta vrotate -1"
            guitext
            guibutton "rotate 90"                  "saycommand [/vrotate 1]"
            guibutton "rotate 180"                  "saycommand [/vrotate 2]"
            guibutton "rotate 270"                  "saycommand [/vrotate 3]"
            guitext
            guibutton "flip vertical"               "saycommand [/vrotate 4]"
            guibutton "flip horizontal"               "saycommand [/vrotate 5]"
            guitext
            guibutton "^foRESET ^fwto 0"            "saycommand [/vrotate 0]"
        ]
    ]

    newgui specscale [
        guitext "^fo/vdelta vshaderparam specscale ^fr%R ^fg%G ^fb%B"
        guitext
        guibutton "red gloss"            "saycommand [/vdelta vshaderparam specscale 1.0 0.3 0.3]"
        guibutton "green gloss"            "saycommand [/vdelta vshaderparam specscale 0.3 1.0 0.3]"
        guibutton "blue gloss"            "saycommand [/vdelta vshaderparam specscale 0.3 0.3 1.0]"
        guibutton "orange gloss"         "saycommand [/vdelta vshaderparam specscale 1.0 0.6 0.2]"
        guibutton "yellow gloss"         "saycommand [/vdelta vshaderparam specscale 1.0 0.8 0.3]"
        guibutton "purple gloss"         "saycommand [/vdelta vshaderparam specscale 0.5 0.2 0.7]"
        guibutton "turquoise gloss"         "saycommand [/vdelta vshaderparam specscale 0.1 0.8 0.8]"
        guibutton "50% gloss (subtle)"      "saycommand [/vdelta vshaderparam specscale 0.5 0.5 0.5]"
        guibutton "no gloss (matte)"      "saycommand [/vdelta vshaderparam specscale 0.0 0.0 0.0]"
        guitext
        guibutton "^foRESET ^fwto 100%"      "saycommand [/vdelta vshaderparam specscale 1.0 1.0 1.0]"
    ]

    newgui glowcolor [
        guitext "^fo/vdelta vshaderparam glowcolor ^fr%R ^fg%G ^fb%B"
        guitext
        guibutton "red"                  "saycommand [/vdelta vshaderparam glowcolor 1.0 0.3 0.3]"
        guibutton "green"               "saycommand [/vdelta vshaderparam glowcolor 0.3 1.0 0.3]"
        guibutton "blue"               "saycommand [/vdelta vshaderparam glowcolor 0.3 0.3 1.0]"
        guibutton "orange"               "saycommand [/vdelta vshaderparam glowcolor 1.0 0.6 0.2]"
        guibutton "yellow"               "saycommand [/vdelta vshaderparam glowcolor 1.0 0.8 0.3]"
        guibutton "purple"               "saycommand [/vdelta vshaderparam glowcolor 0.5 0.2 0.7]"
        guibutton "turquoise"            "saycommand [/vdelta vshaderparam glowcolor 0.1 0.8 0.8]"
        guitext
        guibutton "^foRESET ^fwto 100%"      "saycommand [/vdelta vshaderparam glowcolor 1.0 1.0 1.0]"
    ]

    newgui parallaxscale [
        guitext "^fo/vdelta vshaderparam parallaxscale ^fr%R ^fg%G ^fb%B"
        guitext
        guibutton "flat"                        "saycommand [/vdelta vshaderparam parallaxscale 0.0 0.0 0.0]"
        guibutton "extreme"                        "saycommand [/vdelta vshaderparam parallaxscale 0.0025 0.0025 0.0025]"
        guibutton "another dimension"               "saycommand [/vdelta vshaderparam parallaxscale 1.0 1.0 1.0]"
        guitext
        guibutton "^foRESET ^fwto default"            "saycommand [/vdelta vshaderparam parallaxscale 0.0000025 0.0000025 0.0000025]"
    ]

    newgui vscroll [
        guistayopen [
            guitext    "^fo/vscroll ^fyX Y"
            guitext
            guibutton    "scroll Y +"         "vdelta vscroll 0 +0.1"
            guibutton    "scroll Y -"         "vdelta vscroll 0 -0.1"
            guitext
            guibutton    "scroll X +"         "vdelta vscroll +0.1 0"
            guibutton    "scroll X -"         "vdelta vscroll -0.1 0"
            guitext
            guibutton    "^foRESET ^fwto 0"         "saycommand [/vscroll 0 0]"
        ]
    ]

    newgui voffset [
        guistayopen [
            guitext "^fo/voffset ^fyXpx Ypx"
            guitext
            guibutton    "offset Y +"         "vdelta voffset 0 +16"
            guibutton    "offset Y -"         "vdelta voffset 0 -16"
            guitext
            guibutton    "offset X +"         "vdelta voffset +16 0"
            guibutton    "offset X -"         "vdelta voffset -16 0"
            guitext
            guibutton    "^foRESET ^fwto 0"         "saycommand [/voffset 0 0]"
        ]
    ]

    newgui blendmap [
        guilist [
            guilist [
                guilist [
                    guilist [
                        guistayopen [
                            guitext "assign a blend layer to selected texture:"
                            guitext "^fo/vlayer ^fy# ^fw(slot number)"
                            guitext
                            guilist [
                                guistrut 0
                                guitext "texture slot number: "
                                guifield slotnum -8
                            ]
                            guibutton "^foADD ^fwabove brush" [vlayer $slotnum]
                            guibutton "^foREMOVE ^fwabove brush" [vlayer ""]
                        ]
                    ]
                ]
                guibutton "open textures menu.." [showtexgui]
                guitext
                guistayopen [
                    guibutton "cycle blend paint modes" [
                        hmapedit 0
                        blendpaintmode (? (= $blendpaintmode 5) 0 (+ $blendpaintmode 1))
                        echo (concat "^fgblend mode:^fw" (at $paintmodes $blendpaintmode))
                    ]
                    guibutton "blend mode off" [blendpaintmode 0]
                    guilist [
                        guibutton "cycle paint brush: " [nextblendbrush -1]
                        guitext (getblendbrushname (curblendbrush))
                    ]
                    guitext
                    guibutton "generate preview" showblendmap
                    guitext
                    guibutton "^foCLEAR ^fwBlendmap" clearblendmap
                ]
            ]
            guilist [
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext
                guitext "   key F2"
                guitext
                guitext "   key P"
                guitext   "   key Alt"
                guitext   "    scroll mouse wheel"
                guitext
                guitext
                guitext
            ]
        ]
    ]

    newgui texreset [
        guilist [
            guilist [
            guibutton "^foCLEAR ^fwall unused textures from map cfg" [saycommand /texturecull]
            guibutton "^foCLEAR ^fwall textures from map cfg" [saycommand /texturereset]
            guibutton "^foLOAD ^fwdefault texture package to map cfg (reload map required)" [saycommand /exec data/textures.cfg]
            ]
        ]
    ]

    newgui environment [
        guistayopen [
        guitext         "quick global lighting:"
        guitext
        guibutton      "night"                              [ambient 40 40 40; skylight 70 80 90; skybox skyboxes/stars; skycolour 255 255 255; cloudlayer skyboxes/clouds01; cloudlayercolour 50 60 100; cloudlayerblend 0.3; cloudscrollx 0.005; fogcolour 12 10 13; fog 2000; calclight -1]
        guibutton      "morning"                           [ambient 60 35 40; skylight 170 140 145; skybox penguins/harmony; skycolour 255 160 180; cloudlayer skyboxes/clouds03; cloudlayercolour 255 125 170; cloudlayerblend 0.2; cloudscrollx 0.01; fogcolour 129 79 59; fog 2000; calclight -1]
        guibutton      "evening"                           [ambient 50 30 10; skylight 180 100 70; skybox skyboxes/sunsetflat; skycolour 255 255 255; cloudlayer skyboxes/clouds01; cloudlayercolour 255 100 50; cloudlayerblend 0.2; cloudscrollx 0.005; fogcolour 40 20 5; fog 2000; calclight -1]
        guitext
        guibutton      "^foRESET ^fwenvironment to default"      [ambient 0 0 0; skylight 0 0 0; skybox ""; skycolour 255 255 255; cloudlayer ""; cloudlayercolour 255 255 255; cloudlayerblend 1.0; cloudscrollx 0; fogcolour 128 153 179; fog 4000; calclight -1]

        guitab ambient
        guitext         "^fo/ambient ^frR ^fgG ^fbB"
        guibutton      "grey shadows"                        "saycommand [/ambient 40 40 40]"
        guibutton      "purple shadows"                     "saycommand [/ambient 60 35 40]"
        guibutton      "brown shadows"                        "saycommand [/ambient 50 30 10]"
        guitext
        guibutton      "^foRESET ^fwambient to default"         "saycommand [/ambient 0 0 0]"

        guitab skylight
        guitext         "^fo/skylight ^frR ^fgG ^fbB"
        guibutton      "cool skylight"                        "saycommand [/skylight 70 80 90]"
        guibutton      "soft skylight"                        "saycommand [/skylight 170 140 145]"
        guibutton      "warm skylight"                        "saycommand [/skylight 180 100 70]"
        guitext
        guibutton      "^foRESET ^fwskylight to default"         "saycommand [/skylight 0 0 0]"


        guitab fog
            guitext    "^fo/fog ^fy#"
            guibutton    "fog distance far"            "saycommand [/fog 1500]"
            guibutton    "fog distance distant"         "saycommand [/fog 800]"
            guibutton    "fog distance near"            "saycommand [/fog 300]"
            guibutton    "^foRESET ^fwfog distance"      "saycommand [/fog 4000]"
            guitext
            guitext
            guitext    "^fo/fogcolour ^frR ^fgG ^fbB"
            guibutton    "black fog (darkness)"            "saycommand [/fogcolour 0 0 0]"
            guibutton    "grey fog (haze)"               "saycommand [/fogcolour 50 50 50]"
            guibutton    "green fog (gas)"               "saycommand [/fogcolour 40 60 45]"
            guibutton    "^foRESET ^fwfog color to default"   "saycommand [/fogcolour 128 153 179]"

        guitab skybox
            guitext    "^fo/skybox ^fyfolder/filename"
            guibutton    "set skybox to skyhigh"         "saycommand [/skybox skyboxes/skyhigh]"
            guibutton    "set skybox to sunsetflat"      "saycommand [/skybox skyboxes/sunsetflat]"
            guibutton   "set skybox to gradient"      "saycommand [/skybox skyboxes/gradient]"
            guibutton    "^foREMOVE ^fwskybox"           [saycommand "/skybox ^"^""]
            guitext
            guitext
            guitext      "^fo/skycolour ^frR ^fgG ^fbB"
            guibutton   "set sky color to orange"      "saycommand [/skycolour 255 150 20]"
            guibutton   "set sky color to yellow"      "saycommand [/skycolour 150 150 80]"
            guibutton   "set sky color to red"         "saycommand [/skycolour 180 80 80]"
            guibutton   "set sky color to blue"         "saycommand [/skycolour 80 80 180]"
            guibutton   "set sky color to black"      "saycommand [/skycolour 80 80 80]"
            guibutton    "^foRESET ^fwsky color"         "saycommand [/skycolour 255 255 255]"

        guitab clouds
            guitext    "^fo/cloudlayer ^fyfolder/filename"
            guibutton    "set clouds to clouds01"         "saycommand [/cloudlayer skyboxes/clouds01]"
            guibutton    "set clouds to clouds02"         "saycommand [/cloudlayer skyboxes/clouds02]"
            guibutton    "set clouds to clouds03"         "saycommand [/cloudlayer skyboxes/clouds03]"
            guibutton    "^foREMOVE ^fwcloudlayer"          [saycommand "/cloudlayer ^"^""]
            guitext
            guitext
            guitext      "^fo/cloudlayercolour ^frR ^fgG ^fbB"
            guibutton   "set cloud color to orange"      "saycommand [/cloudlayercolour 255 150 20]"
            guibutton   "set cloud color to yellow"      "saycommand [/cloudlayercolour 150 150 80]"
            guibutton   "set cloud color to red"      "saycommand [/cloudlayercolour 180 80 80]"
            guibutton   "set cloud color to blue"      "saycommand [/cloudlayercolour 80 80 180]"
            guibutton   "set cloud color to black"      "saycommand [/cloudlayercolour 80 80 80]"
            guibutton    "^foRESET ^fwcloud color"      "saycommand [/skycolour 255 255 255]"

            guitab vars
            guitext   "^fo/gravity ^fy%"
            guibutton   "none"                        "saycommand   [/gravity 5.0]"
            guibutton   "low"                        "saycommand [/gravity 15.0]"
            guibutton   "default"                     "saycommand [/gravity 50.0]"
            guitext

            guitext "^fo/spawnweapon ^fy#"
            guilist [
                guilist [
                guibutton "sword"         "saycommand   [/spawnweapon 2]"
                guibutton "shotgun"         "saycommand   [/spawnweapon 3]"
                guibutton "smg"            "saycommand   [/spawnweapon 4]"
                guibutton "flamer"         "saycommand   [/spawnweapon 5]"
                guibutton "taser"           "saycommand   [/spawnweapon 6]"
                ]

                guilist [
                guibutton "         plasma"             "saycommand   [/spawnweapon 7]"
                guibutton "         rifle"            "saycommand   [/spawnweapon 8]"
                guibutton "         grenade"         "saycommand   [/spawnweapon 9]"
                guibutton "         mine"            "saycommand   [/spawnweapon 10]"
                guibutton "         rocket"            "saycommand   [/spawnweapon 11]"
                ]
            ]
                guitext
                guitext   "^foplayer vars"
                guibutton "maximum inventory (default 2)"      "saycommand [/maxcarry 9]"
                guibutton "jumpspeed (default 100)"          "saycommand [/jumpspeed 200]"
                guibutton "impulse freestyle (default 1)"      "saycommand [/impulsestyle 3]"

        guibutton "show all variables.."         "showgui vars"

        ]
    ]
    resetlight = [
        lightcolour = 0
        lightrgb = "255 255 255"
        lightbright = 1
        lightradius = 128
    ]

    lightcmd = [
        lightr = (at $lightrgb 0)
        lightg = (at $lightrgb 1)
        lightb = (at $lightrgb 2)
        if (! $lightbright) [
            if (=s $lightrgb "255 255 255") [
                lightr = 192; lightg = 192; lightb = 192
            ] [
                lightr = (div $lightr 2); lightg = (div $lightg 2); lightb = (div $lightb 2)
            ]
        ]
        result (concat newent light $lightradius $lightr $lightg $lightb)
    ]

    newgui newlight [
        guibutton "create a sunlight entity          " "saycommand [/newent sunlight 45 320 100 70 50]"
        guitext
        guitext "light radius:"
        guislider lightradius 0 800
        guiradio "white"                         lightcolour 0 [lightrgb = "150 150 150"]
        guiradio "blue"                        lightcolour 1 [lightrgb = "80 80 180"]
        guiradio "red"                         lightcolour 2 [lightrgb = "180 80 80"]
        guiradio "green"                       lightcolour 3 [lightrgb = "80 180 80"]
        guiradio "yellow"                      lightcolour 4 [lightrgb = "150 150 80"]
        guiradio "purple"                      lightcolour 5 [lightrgb = "150 80 150"]
        guiradio "turquoise"                   lightcolour 6 [lightrgb = "80 150 150"]
        guitext
        guicheckbox "bright"                   lightbright
        guitext
        guibutton "^foCREATE" (lightcmd)
        guibutton (lightcmd)
    ]


    newgui newteleport [
       guitext "^fo/newent teleport ^fwlink teleports with ^fo/entlink ^fw(key L)"
        guitext
       guibutton "create a new teleport"          "saycommand [/newent teleport -1 0 0 0 655 0]"
    ]

    quickeditmenu = [
        guitext "Quick Commands:"
        guibar
        guifield  savemap_name 10 [ savemap $savemap_name ]
        guibutton quicklight          "calclight -1"
        guibutton "optimize map"      "remip"
        guibutton "new entity"        "newent light"
        guibar
        guibutton newmap
        guibar
        guibutton help "showgui edit"
    ]

    matmenu = [
        guicheckbox      "show material volumes         key M"         "showmat"
        guitext
        guibutton   "air                     key Numpad 1"               "editmat air"
        guibutton   "alpha                  key Numpad 2"                  "editmat alpha"
        guibutton   "water                  key Numpad 3"                  "editmat water"
        guibutton   "lava                     key Numpad 4"               "editmat lava"
        guibutton   "clip                     key Numpad 5"               "editmat clip"
        guibutton   "noclip                  key Numpad 6"                  "editmat noclip"
        guibutton   "aiclip                  key Numpad 7"                  "editmat aiclip"
        guibutton   "death                  key Numpad 8"                  "editmat death"
        guibutton   "ladder                  key Numpad 9"                  "editmat ladder"

    ]

    newentgui = [
        genentattributes [@arg1] [@arg2] [@arg3]
        newgui $arg1 [
            guitext $tmpt
            guibar
            @entattributes
            guitab type
            guilistsplit n 2 $enttypelist [
                guibutton $n [ entset @n ]
            ]
        ]
    ]

    looplist i $enttypelist [
        newentgui $i "" ""
    ]

    newgui materials [
        @matmenu

    ]

    newgui quickedit [
        @quickeditmenu
        guitab materials
        @matmenu
    ]

    newentgui light "radius red green blue" "0 400 0 255 0 255 0 255"
    newentgui spotlight "radius" "0 200"
    newentgui playerstart "yaw team id" "0 360"
    newentgui teleport "tag" "0 20"
    newentgui teledest "yaw tag" "0 360 0 20"
    newentgui monster "yaw type" "0 360 0 7"
    newentgui mapmodel "model yaw type tag flags" "360 0 0 100 0 29 0 20"
    newentgui envmap "radius" "0 400"
    newentgui pusher "Z Y X" "0 200 0 200 0 200"
    newentgui carrot "tag type" "0 50 0 29"
    newentgui sound "type radius size" "0 20 0 500 0 500"
    newentgui particles "type" "0 3"

    alias showmapmodel [
        mapmodelpath = (mapmodelindex $arg1)
        mapmodelshot = (concatword "models/" $mapmodelpath "/thumb")
        mapmodelcmd = (concat newent mapmodel $arg1)
        guilistx 2 [
            guiimage $mapmodelshot $mapmodelcmd 2 1 "textures/nothumb"
            guibutton $mapmodelpath $mapmodelcmd
        ]
    ]

    newgui mapmodels [
        mapmodelnum = (mapmodelindex)
        guilistloop 4 2 $mapmodelnum [ showmapmodel $i ]
    ]

